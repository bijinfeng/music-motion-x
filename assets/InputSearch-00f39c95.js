import{a as s,j as c,r as l,d as A,l as H,t as I,v as O,w as Y,h as F,A as V,x as W,e as v,m as Z,F as P,c as R,S as G,i as h}from"./index-e3a9fa00.js";const q=({searchResultList:e})=>s("div",{className:" px-3 ",children:e.map((t,n)=>t?.type==="song"?c(l.Fragment,{children:[s(A,{title:"歌曲",showMore:!1,style:{color:"grey"}}),s(H,{placeHolderCount:2,list:t.dataList.map(i=>({...t.getDesc(i),type:"song"})),lazyAll:!0})]},`${n}-song`):t?.type==="album"?c(l.Fragment,{children:[s(A,{title:"专辑",showMore:!1,style:{color:"grey"}}),s(I,{placeHolderCount:2,list:t.dataList.map(i=>({...t.getDesc(i),type:"album"}))})]},`${n}-album`):t?.type==="mv"?c(l.Fragment,{children:[s(A,{title:"MV",showMore:!1,style:{color:"grey"}}),s(O,{placeHolderCount:2,list:t.dataList.map(i=>({...t.getDesc(i),type:"mv"}))})]},`${n}-mv`):t?.type==="artist"?c(l.Fragment,{children:[s(A,{title:"艺人",showMore:!1,style:{color:"grey"}}),s(Y,{placeHolderCount:2,list:t.dataList.map(i=>({...t.getDesc(i),type:"artist"}))})]},`${n}-artist`):t?.type==="playlist"?c(l.Fragment,{children:[s(A,{title:"歌单",showMore:!1,style:{color:"grey"}}),s(F,{placeHolderCount:2,list:t.dataList.map(i=>({...t.getDesc(i),type:"playlist"}))})]},`${n}-playlist`):s("div",{},n))}),K=({bestMatch:e})=>c("div",{className:" px-3",children:[s(A,{title:"最佳匹配",showMore:!1,style:{color:"grey"}}),e.type==="artist"&&s(V,{...e,lazyLoading:!0}),e.type==="album"&&s(W,{...e,lazyLoading:!0})]}),X="data:image/png;base64,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",J={artist:{selector:e=>({type:"artist",id:e.id,artistName:e.name,imgUrl:e.img1v1Url||e.picUrl,title:`艺人：${e.name}`,desc:`歌曲：${e.musicSize} 专辑：${e.albumSize}`})},album:{selector:e=>({type:"album",id:e.id,imgUrl:e.picUrl,title:`专辑：${e.name}`,desc:`歌手：${e.artist.name}`})}},$={playlist:{desc:"歌单",selector:e=>({id:e.id,imgUrl:e.coverImgUrl,title:`${e.name}`,desc:`${e.trackCount}首`})},song:{desc:"歌曲",selector:e=>{const t=e.ar.length?[...e.ar].reverse().reduce((n,i)=>`${i.name} ${n}`,""):"";return{imgUrl:e.al.picUrl,title:`${e.name}`,desc:`${t} · ${e.al.name}`,artistId:e.ar[0].id,albumId:e.al.id,artistName:t,albumName:e.al.name,id:e.id}}},artist:{desc:"艺人",selector:e=>({id:e.id,artistName:e.name,imgUrl:e.img1v1Url||e.picUrl,title:`艺人：${e.name}`,desc:`mv:${e.mvSize}  专辑:${e.albumSize}`})},mv:{desc:"MV",selector:e=>({id:e.id,imgUrl:e.cover,title:`${e.name}`,desc:`${e.artistName}`})},album:{desc:"专辑",selector:e=>({id:e.id,imgUrl:e.picUrl,title:e.name,desc:e.artist.name})}},_=l.memo(({setIsFocus:e,isFocus:t})=>{_.displayName="InputSearch";const n=l.useRef(null),i=l.useRef(!1),[r,p]=l.useState(""),[z,k]=l.useState(!1),T=l.useCallback(async()=>{e(!0)},[e]),D=l.useCallback(a=>{i.current||l.startTransition(()=>{p(a.target.value)})},[]),B=()=>{i.current=!0},N=a=>{l.startTransition(()=>{p(a.currentTarget.value)}),i.current=!1},C=a=>{n.current&&(n.current.value=a),p(a)},x=l.useCallback(()=>{e(!1),C("")},[e]),{data:d,isLoading:S}=v(r?`/api/search/multimatch?keywords=${r}`:"",()=>r?h.get(`/api/search/multimatch?keywords=${r}`).then(a=>{if(a.data.result.orders?.length){const o=a.data.result.orders[0];return J[o]?.selector?.(a.data.result[o]?.[0])}}):null,{refetchOnWindowFocus:!1,suspense:!1}),{data:y}=v(r?`/api/search/suggest?keywords=${r}&type=mobile`:"",()=>r?h.get(`/api/search/suggest?keywords=${r}&type=mobile`).then(a=>a.data.result.allMatch?.map(o=>o.keyword)??[]):null,{refetchOnWindowFocus:!1,suspense:!1}),{data:f,isLoading:u}=v(r?`/api/search?keywords=${r}&type=1004`:"",()=>r?Promise.allSettled([h.get(`/api/search?keywords=${r}&type=1018`).then(a=>a.data.result),h.get(`/api/search?keywords=${r}&type=1004`).then(a=>a.data.result)]).then(a=>{const o=a[0],M=a[1];if(o.status==="fulfilled"&&M.status==="fulfilled"&&(o.value.mv=M.value,o.value.order?.length))return[...o.value.order,"mv"].map(m=>{const E=m.toLowerCase(),b=$[E];let g=o.value?.[m]?.[`${m}s`];return E==="song"&&(g=g.slice(0,5)),b&&g?{type:E,title:b.desc,getDesc:b.selector,dataList:g}:null}).filter(m=>!!m)}):null,{refetchOnWindowFocus:!1,suspense:!1}),Q=!!d&&["artist","album"].includes(d.type),w=!!f&&f.length&&!u,U=!!y&&!!y.length&&!w&&!u,j=!d&&!S&&r&&!w&&!u,L=S&&u&&t&&!!r;return Z(()=>{l.startTransition(()=>{k(L)})},[L]),c(P,{children:[c("div",{className:R(" items-center bg-mg z-[99]",{"block mt-5":!t,"flex mt-0":t}),style:{transition:"all 0.3s ease-in-out"},children:[s("input",{className:" relative z-[1000] text-fg text-base border-none h-8 rounded-[200px] w-full bg- outline-none bg-black indent-8 transition-width duration-700 bg-[length:16px_16px] bg-no-repeat",ref:n,type:"text",onFocus:T,onChange:D,onCompositionStart:B,onCompositionEnd:N,placeholder:t?"搜索":"",style:{backgroundImage:`url(${X})`,backgroundPosition:"9px center"}}),s("span",{className:R(" ml-3 text-fg text-base whitespace-nowrap relative z-[1000] ",{" visible":t,invisible:!t," w-7":t," w-0":!t}),style:{transition:" width 0.6s"},onClick:x,children:"取消"})]},"kepp"),t&&!r&&s("p",{className:" text-dg text-center mt-20 text-sm",children:"搜点什么吧"}),Q&&s(K,{bestMatch:d}),U&&c("div",{className:" px-3",children:[s(A,{title:"搜索建议",showMore:!1,style:{color:"grey"}}),y.map(a=>s("div",{className:" mt-3 text-base text-fg pl-1",onClick:()=>C(a),children:a},a))]}),w&&s(q,{searchResultList:f}),j&&s("p",{className:" text-fg text-center mt-10",children:"木有结果～"}),z&&s(G,{style:{marginTop:40}})]})});export{_ as default};
