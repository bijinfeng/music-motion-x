import{b as c,a as g,j as R}from"./index-12c2092c.js";import{u as M}from"./useQuery-f35a1b42.js";import{M as q,c as I}from"./MediaItemList-9cd646f5.js";import{u as A}from"./useIsomorphicEffect-25b21b46.js";import{b as X}from"./routes-c682a871.js";import"./extends-98964cd2.js";import"./inheritsLoose-54b40604.js";import"./index-78d1f01c.js";import"./index-8f535541.js";import"./index-7c9c9a2c.js";import"./Spinner-3ac26fa1.js";const B=c.memo(c.forwardRef((N,w)=>{const{banners:o,onBannerChange:h}=N,p=c.useRef(),d=c.useRef(),n=c.useRef(null),l=c.useRef(0),y=c.useRef(0),a=c.useRef(0),$=c.useCallback(()=>{clearTimeout(p.current),clearTimeout(d.current)},[]),C=c.useCallback(()=>{const t=l.current,e=(t+1)%o.length,r=n.current?.childNodes?.[t],s=n.current?.childNodes?.[e];if(!r||!s)return;r.style.transition="none",s.style.transition="none",r.style.transform=`translate3d(${-100*t}%, 0, 0)`,s.style.transform=`translate3d(${100-100*e}%, 0, 0)`,s.style.transform=`${s.style.transform}scale(0.8)`;const i=()=>{r.style.transition="",s.style.transition="",r.style.transform=`translate3d(${-100-100*t}%, 0, 0)`,r.style.transform=`${r.style.transform}scale(0.8)`,s.style.transform=`translate3d(${-100*e}%, 0, 0)`,l.current=e,h(l.current)};requestAnimationFrame(()=>{requestAnimationFrame(()=>{try{i()}catch(u){console.log(u)}})}),d.current=setTimeout(()=>{try{C()}catch(u){console.log(u)}},3e3)},[o.length,h]),b=c.useCallback(t=>{if(t!=null){h(t),$();const e=n.current?.childNodes?.[l.current];if(!e)return;e.style.transition="none",e.style.transform=`translate3d(${(o.length+1)*100}%, 0, 0)`;const r=n.current?.childNodes?.[t];r.style.transition="none",r.style.transform=`translate3d(${-100*t}%, 0, 0)`,l.current=t}else h(l.current);p.current=setTimeout(()=>{try{C()}catch(e){console.log(e)}},3e3)},[o.length,C,h,$]),L=c.useCallback(()=>{clearTimeout(p.current),b()},[b]),x=c.useCallback((t,e,r,s,i,u)=>{$(),y.current=t,e.style.transition="none",r.style.transition="none",s.style.transition="none",e.style.transform=`translate3d(${-a.current*l.current}px, 0, 0)`,r.style.transform=`translate3d(${-a.current-a.current*i}px, 0, 0)`,s.style.transform=`translate3d(${a.current-a.current*u}px, 0, 0)`},[$]),E=c.useCallback((t,e,r,s,i,u)=>{e.style.transform=`translate3d(${t-y.current-a.current*l.current}px, 0, 0)`,e.style.transform=`${e.style.transform}scale(${1-Math.abs((t-y.current)/(a.current*2.5))})`,r.style.transform=`translate3d(${t-y.current-a.current-a.current*i}px, 0, 0)`,r.style.transform=`${r.style.transform}scale(0.9)`,s.style.transform=`translate3d(${t-y.current+a.current-a.current*u}px, 0, 0)`,s.style.transform=`${s.style.transform}scale(0.9)`},[]),k=c.useCallback((t,e,r,s,i,u)=>{let m=0;t-y.current>a.current*.3?m=1:t-y.current<-a.current*.3&&(m=-1),e.style.transition="",r.style.transition="",s.style.transition="",e.style.transform=`translate3d(${m*a.current-a.current*l.current}px, 0, 0)`,r.style.transform=`translate3d(${m*a.current-a.current-a.current*i}px, 0, 0)`,s.style.transform=`translate3d(${m*a.current+a.current-a.current*u}px, 0, 0)`,l.current=(l.current-m+o.length)%o.length,L()},[o.length,L]),P=c.useCallback(t=>{const e=(l.current-1+o.length)%o.length,r=(l.current+1)%o.length,s=n.current?.childNodes?.[l.current],i=n.current?.childNodes?.[e],u=n.current?.childNodes?.[r];x(t.clientX,s,i,u,e,r);const m=f=>{E(f.clientX,s,i,u,e,r)},v=f=>{k(f.clientX,s,i,u,e,r),n.current.removeEventListener("mousemove",m),n.current.removeEventListener("mouseup",v),n.current.removeEventListener("mouseleave",v)};n.current.addEventListener("mousemove",m),n.current.addEventListener("mouseup",v),n.current.addEventListener("mouseleave",v)},[o.length,k,E,x]),T=c.useCallback(()=>{n.current.addEventListener("mousedown",P),n.current.addEventListener("touchstart",t=>{t.cancelable&&t.preventDefault();const e=(l.current-1+o.length)%o.length,r=(l.current+1)%o.length,s=n.current?.childNodes?.[l.current],i=n.current?.childNodes?.[e],u=n.current?.childNodes?.[r];x(t.changedTouches[0].pageX,s,i,u,e,r);const m=f=>{f.cancelable&&f.preventDefault(),E(f.changedTouches[0].pageX,s,i,u,e,r)},v=f=>{k(f.changedTouches[0].pageX,s,i,u,e,r),n.current.removeEventListener("touchmove",m),n.current.removeEventListener("touchend",v)};n.current.addEventListener("touchmove",m,{passive:!1}),n.current.addEventListener("touchend",v,{passive:!0})},{passive:!0})},[o.length,P,k,E,x]);return A(()=>{b(),requestAnimationFrame(()=>{a.current=parseInt(getComputedStyle(n.current).width,10),T()})},[T,b]),c.useImperativeHandle(w,()=>({nextPic:b})),g("div",{ref:n,className:" absolute w-full top-0 left-0 whitespace-nowrap touch-pan-x",children:o.map((t,e)=>g("div",{className:" w-full inline-block transition-transform ease-in-out duration-700 scale-100 ",children:e===0?g("img",{className:" w-full rounded-[10px]",src:t?t.replace(/https?/,"https"):"",alt:"",draggable:!1}):g(q,{url:t,className:" w-full rounded-[10px]"})},e))})}));B.displayName="MyBanner";const j=c.memo(()=>{const[N,w]=c.useState(0),o=c.useRef({nextPic:d=>{}}),h=c.useCallback(d=>{w(d)},[]),{data:p}=M("/api/banner?type=2",X);return R("div",{className:" w-full relative overflow-hidden",style:{padding:"39% 0 0"},"data-testid":"test-banners",children:[g("div",{className:" absolute bottom-1 left-1/2 -translate-x-1/2 z-20 will-change-transform",children:p?.map((d,n)=>g("li",{className:I(" mr-1 w-[6px] h-[6px] inline-block rounded-[50%]",{"bg-secondary":N===n," bg-white":N!==n}),onClick:()=>{o.current.nextPic(n)}},n))}),!!p&&p?.length>0&&g(B,{banners:p.map(d=>d.pic?d.pic.replace(/https?/,"https"):""),onBannerChange:h,ref:o})]})});j.displayName="Banners";export{j as default};
